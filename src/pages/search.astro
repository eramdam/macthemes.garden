---
import { getCollection, getEntries } from "astro:content";
import { pick } from "lodash-es";
import OS9Window from "../components/OS9Window.astro";
import { SearchForm } from "../components/search";
import BaseLayout from "../layouts/BaseLayout.astro";
const themes = await getCollection("themes");
const themesWithAuthorsPromise = themes.map(async (t) => {
  return {
    ...t,
    data: {
      ...t.data,
      authors: (await getEntries(t.data.authors)).map((a) =>
        pick(a.data, ["name", "url"])
      ),
    },
  };
});
const themesWithAuthors = (await Promise.all(themesWithAuthorsPromise)).map(
  (t) =>
    pick(t.data, [
      "urlBase",
      "mainThumbnail",
      "name",
      "year",
      "isNew",
      "authors",
    ])
);
---

<style is:global>
  .search {
    display: flex;
    align-items: center;
    padding: 0 10px;
    min-height: 43px;
  }
  section {
    text-align: center;
  }
  form,
  .pagination {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  form {
    flex: 1;

    padding: 5px;
  }

  form input {
    border-radius: 0;
    border: 1px solid var(--primary-black);
    box-shadow:
      1px 1px 0 var(--grays-700),
      -1px -1px 0 var(--primary-white);
  }
</style>
<BaseLayout title="Search">
  <OS9Window title="Search">
    <SearchForm client:load themes={themesWithAuthors} />
  </OS9Window>
</BaseLayout>
