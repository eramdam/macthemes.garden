---
import type { GetStaticPaths } from "astro";
import { getCollection, getEntries } from "astro:content";

import OS9Window from "../../components/OS9Window.astro";
import { archiveFileSize, archiveMd5 } from "../../helpers";
import BaseLayout from "../../layouts/BaseLayout.astro";
import AuthorsFormatter from "../../components/AuthorsFormatter.astro";
export const getStaticPaths = (async () => {
  const themes = await getCollection("themes");
  return themes.map((t) => {
    return {
      props: { theme: t },
      params: {
        slug: t.data.urlBase,
      },
    };
  });
}) satisfies GetStaticPaths;
const theme = Astro.props.theme.data;
const isDev =
  import.meta.env.DEV && import.meta.env.PUBLIC_SHOW_DEBUG === "true";
const relatedThemes = await getEntries(Astro.props.theme.data.relatedThemes);
const hasMoreThemesInArchive = relatedThemes.length > 0;
---

<style>
  .related-themes {
    display: flex;
    flex-direction: column;
    padding: 10px 0;
    padding-top: 20px;
    gap: 20px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    align-items: center;
    justify-content: center;
  }

  .related-single-theme {
    display: flex;
    flex-direction: column;
    gap: 10px;
    text-align: left;
  }

  .related-single-theme > span {
    font-size: 0.8rem;
    display: flex;
    flex-direction: column;
  }
</style>
<BaseLayout title={theme.name}>
  <OS9Window asElement="main" title={theme.name}>
    <section class="single-theme-page">
      <h1 class="single-theme-title">{theme.name}</h1>
      <div class="single-theme-grid">
        <div class="gallery">
          {
            theme.thumbnails.map((image) => {
              return (
                <a
                  class="gallery-thumbnail"
                  href={image}
                  target="_blank"
                  rel="noopener"
                >
                  <img src={image} alt="" />
                </a>
              );
            })
          }
        </div>
        <div class="infos">
          <dl>
            <dt>Name:</dt>
            <dd>{theme.name}</dd>

            <dt>Author(s):</dt>
            <dd>
              <AuthorsFormatter asLinks authors={theme.authors} />
            </dd>

            <dt>Release year:</dt>
            <dd>{theme.year}</dd>

            {
              isDev && (
                <Fragment>
                  <dt>Is new to Airtable:</dt>
                  <dd>{theme.isNew ? "Yes" : "No"}</dd>
                </Fragment>
              )
            }

            <dt>Download:</dt>
            <dd>
              <ul>
                <li>
                  <a
                    href={`https://files.macthemes.garden/${theme.archiveFile}`}
                    >#1 (files.macthemes.garden)</a
                  >
                </li>
              </ul>
            </dd>
            <dd>
              {theme.archiveFile}
              {archiveFileSize(theme.archiveFile)}
            </dd>
            <dd>
              MD5
              <a
                href={`https://files.macthemes.garden/${theme.archiveFile}.md5`}
              >
                {archiveMd5(theme.archiveFile)}</a
              >
            </dd>
            {
              hasMoreThemesInArchive && (
                <Fragment>
                  <dt>More from the same archive file:</dt>
                  <dd class="related-themes">
                    {relatedThemes.map((t) => {
                      return (
                        <a
                          class="related-single-theme"
                          href={`/themes/${t.data.urlBase}`}
                        >
                          <img
                            src={t.data.mainThumbnail}
                            loading="lazy"
                            decoding="async"
                            alt={`${t.data.name} by ${t.data.authors.join(", ")}`}
                          />
                          <span>{t.data.name}</span>
                        </a>
                      );
                    })}
                  </dd>
                </Fragment>
              )
            }
          </dl>
        </div>
      </div>
    </section>
  </OS9Window>
</BaseLayout>
